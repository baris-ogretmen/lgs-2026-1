<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LGS Pro Akademi - V4 (Soru Bankasƒ± Modu)</title>
    
    <!-- React & ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.min.js"></script>
    
    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#4f46e5', secondary: '#0ea5e9' },
                    fontFamily: { sans: ['Outfit', 'sans-serif'], brand: ['Fredoka', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Fredoka:wght@500;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #f8fafc; color: #1e293b; margin: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .brand { font-family: 'Fredoka', sans-serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        
        /* Loader */
        .loader { border: 5px solid #e2e8f0; border-top: 5px solid #4f46e5; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .anim-fade { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Metin Stilleri */
        .readable-text strong { color: #4f46e5; font-weight: 800; }
        .readable-text em { background-color: #fff7ed; color: #c2410c; padding: 2px 6px; border-radius: 4px; font-weight: 600; font-style: normal;}
        .readable-text ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .readable-text h3 { font-size: 1.4rem; font-weight: 800; margin-top: 1.5rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; color: #1e293b; }
    </style>
</head>
<body>
    <div id="root" class="h-screen w-full flex items-center justify-center bg-slate-50">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold text-slate-700">LGS Pro Y√ºkleniyor...</h2>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SABƒ∞T VERƒ∞LER ---
        const DEFAULT_MODEL = "gemini-2.5-flash-preview-09-2025";
        
        const CURRICULUM = {
            MATEMATIK: { title: "Matematik", color: "indigo", icon: "calculator", units: [
                { id: 1, title: "√áarpanlar ve Katlar", topics: ["√áarpanlar ve Katlar", "EBOB - EKOK"] },
                { id: 2, title: "√úsl√º ƒ∞fadeler", topics: ["√úsl√º ƒ∞fadeler", "Bilimsel G√∂sterim"] },
                { id: 3, title: "Karek√∂kl√º ƒ∞fadeler", topics: ["Karek√∂kl√º ƒ∞fadeler", "Ger√ßek Sayƒ±lar"] },
                { id: 4, title: "Veri Analizi", topics: ["Grafik T√ºrleri", "Veri Yorumlama"] },
                { id: 5, title: "Olasƒ±lƒ±k", topics: ["Basit Olaylarƒ±n Olasƒ±lƒ±ƒüƒ±"] },
                { id: 6, title: "Cebirsel ƒ∞fadeler", topics: ["Cebirsel ƒ∞fadeler", "√ñzde≈ülikler"] }
            ]},
            FEN: { title: "Fen Bilimleri", color: "emerald", icon: "flask", units: [
                { id: 1, title: "Mevsimler ve ƒ∞klim", topics: ["Mevsimlerin Olu≈üumu", "ƒ∞klim ve Hava"] },
                { id: 2, title: "DNA ve Genetik Kod", topics: ["DNA", "Kalƒ±tƒ±m", "Mutasyon", "Biyoteknoloji"] },
                { id: 3, title: "Basƒ±n√ß", topics: ["Katƒ± Basƒ±ncƒ±", "Sƒ±vƒ± ve Gaz Basƒ±ncƒ±"] },
                { id: 4, title: "Madde ve End√ºstri", topics: ["Periyodik Sistem", "Asitler ve Bazlar"] }
            ]},
            TURKCE: { title: "T√ºrk√ße", color: "rose", icon: "book", units: [
                { id: 1, title: "S√∂zc√ºk ve C√ºmle", topics: ["S√∂zc√ºkte Anlam", "C√ºmlede Anlam"] },
                { id: 2, title: "Paragraf", topics: ["Paragrafƒ±n Anlamƒ±", "S√∂zel Mantƒ±k"] },
                { id: 3, title: "Dil Bilgisi", topics: ["Fiilimsiler", "C√ºmlenin √ñgeleri"] },
                { id: 4, title: "Yazƒ±m - Noktalama", topics: ["Yazƒ±m Kurallarƒ±", "Noktalama ƒ∞≈üaretleri"] }
            ]},
            INKILAP: { title: "ƒ∞nkƒ±lap Tarihi", color: "orange", icon: "scroll", units: [
                { id: 1, title: "Bir Kahraman Doƒüuyor", topics: ["Mustafa Kemal'in Hayatƒ±"] },
                { id: 2, title: "Milli Uyanƒ±≈ü", topics: ["I. D√ºnya Sava≈üƒ±", "Cemiyetler"] },
                { id: 3, title: "Ya ƒ∞stiklal Ya √ñl√ºm", topics: ["Cepheler", "Lozan Antla≈ümasƒ±"] }
            ]},
            INGILIZCE: { title: "ƒ∞ngilizce", color: "sky", icon: "languages", units: [
                { id: 1, title: "Friendship", topics: ["Accepting and Refusing"] },
                { id: 2, title: "Teen Life", topics: ["Daily Routines"] },
                { id: 3, title: "The Kitchen", topics: ["Cooking Processes"] }
            ]},
            DIN: { title: "Din K√ºlt√ºr√º", color: "teal", icon: "moon", units: [
                { id: 1, title: "Kader ƒ∞nancƒ±", topics: ["Kader ve Kaza"] },
                { id: 2, title: "Zekat ve Sadaka", topics: ["Zekat ƒ∞badeti"] }
            ]}
        };

        const THEME_COLORS = {
            MATEMATIK: "bg-indigo-50 text-indigo-900 border-indigo-200",
            FEN: "bg-emerald-50 text-emerald-900 border-emerald-200",
            TURKCE: "bg-rose-50 text-rose-900 border-rose-200",
            INKILAP: "bg-orange-50 text-orange-900 border-orange-200",
            INGILIZCE: "bg-sky-50 text-sky-900 border-sky-200",
            DIN: "bg-teal-50 text-teal-900 border-teal-200"
        };
        
        const BUTTON_COLORS = {
            MATEMATIK: "bg-indigo-600 hover:bg-indigo-700",
            FEN: "bg-emerald-600 hover:bg-emerald-700",
            TURKCE: "bg-rose-600 hover:bg-rose-700",
            INKILAP: "bg-orange-600 hover:bg-orange-700",
            INGILIZCE: "bg-sky-600 hover:bg-sky-700",
            DIN: "bg-teal-600 hover:bg-teal-700"
        };

        // --- YARDIMCI FONKSƒ∞YONLAR ---
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
        };

        const callGoogle = async (apiKey, modelName, input, type = 'json') => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
            const contents = Array.isArray(input) ? input : [{ parts: [{ text: input }] }];
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents }) });
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                let text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("Bo≈ü Cevap");
                if (type === 'html' || type === 'text') return text;
                text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const s = text.indexOf('['); const e = text.lastIndexOf(']');
                if (s !== -1 && e !== -1) text = text.substring(s, e+1);
                return JSON.parse(text);
            } catch (e) { console.error(e); throw e; }
        };

        // --- QUIZ RUNNER (TEST √á√ñZME EKRANI) ---
        const QuizRunner = ({ apiKey, topic, config, goBack }) => {
            const [questions, setQuestions] = useState(null);
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            const [showAnswer, setShowAnswer] = useState(false);
            const [loading, setLoading] = useState(true);
            const [finished, setFinished] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                const loadQuestions = async () => {
                    if (!apiKey) return;
                    try {
                        let prompt = "";
                        if (topic) {
                            prompt = `8. Sƒ±nƒ±f LGS "${topic}" konusu ile ilgili 5 adet √ßoktan se√ßmeli, zorlayƒ±cƒ±, yeni nesil soru hazƒ±rla. JSON formatƒ±nda: { "questions": [ { "q": "Soru metni", "opts": ["A ≈üƒ±kkƒ±", "B ≈üƒ±kkƒ±", "C ≈üƒ±kkƒ±", "D ≈üƒ±kkƒ±"], "ans": 0 (doƒüru ≈üƒ±k indexi 0-3), "exp": "√á√∂z√ºm a√ßƒ±klamasƒ±" } ] }`;
                        } else if (config) {
                            prompt = `LGS ${config.type} denemesi i√ßin ${config.count} adet karma ve yeni nesil soru hazƒ±rla. JSON formatƒ±nda: { "questions": [ { "q": "Soru metni (Ders adƒ±nƒ± da belirt)", "opts": ["A", "B", "C", "D"], "ans": 0, "exp": "A√ßƒ±klama" } ] }`;
                        }
                        
                        const res = await callGoogle(apiKey, DEFAULT_MODEL, prompt, 'json');
                        let qData = res.questions || res;
                        if(Array.isArray(qData)) {
                            setQuestions(qData);
                        } else {
                            throw new Error("Format hatasƒ±");
                        }
                    } catch (e) {
                        setError("Sorular hazƒ±rlanamadƒ±. L√ºtfen tekrar dene.");
                        console.error(e);
                    } finally {
                        setLoading(false);
                    }
                };
                loadQuestions();
            }, [apiKey, topic, config]);

            const handleAnswer = (idx) => {
                if (showAnswer) return;
                setShowAnswer(true);
                if (idx === questions[currentQ].ans) {
                    setScore(score + 1);
                }
            };

            const nextQuestion = () => {
                if (currentQ < questions.length - 1) {
                    setCurrentQ(currentQ + 1);
                    setShowAnswer(false);
                } else {
                    setFinished(true);
                }
            };

            if (error) return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center">
                    <Icon name="alert-triangle" size={64} className="text-red-500 mb-4"/>
                    <h3 className="text-xl font-bold mb-4">{error}</h3>
                    <button onClick={goBack} className="bg-slate-200 px-6 py-3 rounded-xl font-bold">Geri D√∂n</button>
                </div>
            );

            if (loading) return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center">
                    <div className="loader mb-6"></div>
                    <h3 className="text-2xl font-bold text-indigo-700 animate-pulse">Yapay Zeka Sorularƒ± Hazƒ±rlƒ±yor...</h3>
                    <p className="text-slate-500 mt-2">L√ºtfen bekleyin, LGS moduna ge√ßiliyor.</p>
                </div>
            );

            if (finished) return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center anim-fade">
                    <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl border-4 border-indigo-100 max-w-lg w-full">
                        <Icon name="trophy" size={80} className="text-yellow-500 mx-auto mb-6"/>
                        <h2 className="text-4xl font-black text-slate-800 mb-2">Test Bitti!</h2>
                        <div className="text-6xl font-black text-indigo-600 mb-4">{score} / {questions.length}</div>
                        <p className="text-slate-500 text-lg mb-8 font-medium">
                            {score === questions.length ? "M√ºkemmelsin ≈ûampiyon! üèÜ" : "Gayet iyi, √ßalƒ±≈ümaya devam! üí™"}
                        </p>
                        <button onClick={goBack} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-xl hover:bg-indigo-700 shadow-lg transition">Tamamla</button>
                    </div>
                </div>
            );

            const q = questions[currentQ];

            return (
                <div className="h-full flex flex-col bg-slate-50 p-4 md:p-8 anim-fade">
                    <div className="flex justify-between items-center mb-6">
                        <button onClick={goBack} className="bg-white px-4 py-2 rounded-xl font-bold shadow text-slate-600 hover:text-red-500">√áƒ±kƒ±≈ü</button>
                        <div className="bg-indigo-100 text-indigo-700 px-6 py-2 rounded-full font-black text-lg shadow-sm">
                            Soru {currentQ + 1} / {questions.length}
                        </div>
                        <div className="font-bold text-emerald-600">Doƒüru: {score}</div>
                    </div>

                    <div className="flex-1 overflow-y-auto max-w-4xl mx-auto w-full">
                        <div className="bg-white p-6 md:p-10 rounded-[2rem] shadow-xl border-2 border-slate-100 mb-6">
                            <span className="text-xs font-black text-slate-400 uppercase tracking-widest mb-3 block">SORU METNƒ∞</span>
                            <div className="text-xl md:text-2xl font-bold text-slate-800 leading-relaxed">
                                {q.q}
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-4 mb-6">
                            {q.opts.map((opt, idx) => (
                                <button 
                                    key={idx} 
                                    onClick={() => handleAnswer(idx)}
                                    disabled={showAnswer}
                                    className={`w-full text-left p-5 rounded-2xl border-2 text-lg font-medium transition-all duration-300 relative overflow-hidden
                                        ${showAnswer 
                                            ? (idx === q.ans 
                                                ? 'bg-emerald-100 border-emerald-500 text-emerald-900' 
                                                : (idx === q.ans ? 'opacity-100' : 'opacity-50 grayscale bg-slate-100'))
                                            : 'bg-white border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 hover:pl-8'
                                        }
                                    `}
                                >
                                    <span className="font-bold mr-3">{String.fromCharCode(65 + idx)})</span> {opt}
                                    {showAnswer && idx === q.ans && <Icon name="check-circle" className="absolute right-4 top-1/2 -translate-y-1/2 text-emerald-600"/>}
                                </button>
                            ))}
                        </div>

                        {showAnswer && (
                            <div className="bg-indigo-50 border-l-8 border-indigo-500 p-6 rounded-r-2xl mb-20 anim-fade">
                                <h4 className="font-black text-indigo-700 mb-2 flex items-center gap-2"><Icon name="info"/> √á√∂z√ºm A√ßƒ±klamasƒ±:</h4>
                                <p className="text-slate-700 text-lg leading-relaxed">{q.exp}</p>
                                <button onClick={nextQuestion} className="mt-6 w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-xl hover:bg-indigo-700 shadow-xl transition">
                                    {currentQ < questions.length - 1 ? "Sƒ±radaki Soruya Ge√ß ‚û°" : "Testi Bitir üèÅ"}
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- DASHBOARD (ANA SAYFA) ---
        const Dashboard = ({ apiKey, setApiKey, goView, daysLeft, startTrial }) => {
            const [keyInput, setKeyInput] = useState(apiKey || "");
            const [trialType, setTrialType] = useState(null);

            if (trialType) {
                return (
                    <div className="h-full p-6 flex flex-col items-center justify-center anim-fade">
                        <button onClick={()=>setTrialType(null)} className="absolute top-6 left-6 bg-white p-3 rounded-full shadow"><Icon name="arrow-left"/></button>
                        <div className="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl max-w-lg w-full text-center border-4 border-indigo-50">
                            <Icon name="file-badge" size={64} className="text-indigo-600 mx-auto mb-6"/>
                            <h2 className="text-3xl font-black text-slate-800 mb-8">Deneme Sƒ±navƒ± Olu≈ütur</h2>
                            <div className="space-y-4 mb-8">
                                <button onClick={()=>startTrial({type:'SAYISAL', count:20})} className="w-full p-5 bg-indigo-50 text-indigo-700 font-bold rounded-2xl border-2 border-indigo-100 hover:bg-indigo-600 hover:text-white transition text-lg flex items-center gap-3"><Icon name="calculator"/> Sayƒ±sal (Mat-Fen)</button>
                                <button onClick={()=>startTrial({type:'SOZEL', count:20})} className="w-full p-5 bg-rose-50 text-rose-700 font-bold rounded-2xl border-2 border-rose-100 hover:bg-rose-600 hover:text-white transition text-lg flex items-center gap-3"><Icon name="book-open"/> S√∂zel (Tr-ƒ∞nk-Din-ƒ∞ng)</button>
                                <button onClick={()=>startTrial({type:'GENEL', count:20})} className="w-full p-5 bg-emerald-50 text-emerald-700 font-bold rounded-2xl border-2 border-emerald-100 hover:bg-emerald-600 hover:text-white transition text-lg flex items-center gap-3"><Icon name="layers"/> LGS Genel Deneme</button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="flex flex-col items-center p-4 md:p-8 max-w-7xl mx-auto pb-24 anim-fade h-full overflow-y-auto">
                    <div className="text-center mb-8 md:mb-12">
                        <div className="inline-block p-4 bg-white rounded-full shadow-lg mb-4 border-4 border-indigo-50"><Icon name="rocket" size={48} className="text-indigo-600"/></div>
                        <h1 className="text-4xl md:text-6xl font-black text-slate-800 brand mb-2 tracking-tight">LGS PRO AKADEMƒ∞</h1>
                        <p className="text-indigo-600 font-bold tracking-widest text-sm md:text-lg">2026 EFSANE TAYFA</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full mb-8 md:mb-12">
                        <div className="bg-gradient-to-br from-indigo-600 to-purple-600 rounded-[2.5rem] p-8 text-white shadow-xl relative overflow-hidden h-64 flex flex-col justify-center">
                            <div className="text-indigo-100 font-bold uppercase tracking-wider mb-2">B√ºy√ºk G√ºne Kalan</div>
                            <div className="text-7xl font-black">{daysLeft}</div>
                            <div className="text-2xl font-bold mt-1">G√úN</div>
                            <Icon name="timer" className="absolute -right-8 -bottom-8 opacity-20 w-48 h-48 text-white"/>
                        </div>
                        
                        <div className="bg-white rounded-[2.5rem] p-8 shadow-xl border-2 border-slate-100 h-64 flex flex-col justify-center relative overflow-hidden">
                            {!apiKey ? (
                                <div className="z-10 w-full">
                                    <div className="flex items-center gap-2 text-orange-600 font-bold mb-3 text-lg"><Icon name="key"/> Anahtar Gerekli</div>
                                    <div className="flex gap-2">
                                        <input value={keyInput} onChange={e=>setKeyInput(e.target.value)} className="flex-1 border-2 border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-indigo-500" placeholder="AIzaSy..."/>
                                        <button onClick={()=>{if(keyInput){localStorage.setItem('lgs_key',keyInput); setApiKey(keyInput);}}} className="bg-indigo-600 text-white px-6 rounded-xl font-bold">KAYDET</button>
                                    </div>
                                </div>
                            ) : (
                                <div className="z-10 text-center w-full">
                                    <div className="inline-flex items-center gap-2 bg-emerald-100 text-emerald-700 px-6 py-3 rounded-full font-bold mb-6 text-lg"><Icon name="check-circle"/> Sistem Aktif</div>
                                    <button onClick={()=>setApiKey("")} className="block w-full text-slate-400 hover:text-red-500 underline font-medium">Anahtarƒ± Deƒüi≈ütir</button>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 w-full">
                        <button onClick={()=>goView('syllabus')} className="bg-white p-6 rounded-[2rem] shadow-lg hover:shadow-2xl hover:-translate-y-2 transition border-b-8 border-indigo-100 h-48 flex flex-col items-center justify-center gap-3 group">
                            <div className="bg-indigo-50 text-indigo-600 p-5 rounded-2xl group-hover:scale-110 transition"><Icon name="book-open" size={40}/></div>
                            <span className="font-bold text-slate-700 text-lg">DERSLER</span>
                        </button>
                        <button onClick={()=>setTrialType(true)} className="bg-white p-6 rounded-[2rem] shadow-lg hover:shadow-2xl hover:-translate-y-2 transition border-b-8 border-violet-100 h-48 flex flex-col items-center justify-center gap-3 group">
                            <div className="bg-violet-50 text-violet-600 p-5 rounded-2xl group-hover:scale-110 transition"><Icon name="file-badge" size={40}/></div>
                            <span className="font-bold text-slate-700 text-lg">DENEME √á√ñZ</span>
                        </button>
                        <button onClick={()=>goView('solver')} className="bg-white p-6 rounded-[2rem] shadow-lg hover:shadow-2xl hover:-translate-y-2 transition border-b-8 border-blue-100 h-48 flex flex-col items-center justify-center gap-3 group">
                            <div className="bg-blue-50 text-blue-600 p-5 rounded-2xl group-hover:scale-110 transition"><Icon name="help-circle" size={40}/></div>
                            <span className="font-bold text-slate-700 text-lg">SORU √á√ñZD√úR</span>
                        </button>
                        <button onClick={()=>goView('planner')} className="bg-white p-6 rounded-[2rem] shadow-lg hover:shadow-2xl hover:-translate-y-2 transition border-b-8 border-rose-100 h-48 flex flex-col items-center justify-center gap-3 group">
                            <div className="bg-rose-50 text-rose-600 p-5 rounded-2xl group-hover:scale-110 transition"><Icon name="calendar" size={40}/></div>
                            <span className="font-bold text-slate-700 text-lg">PROGRAM</span>
                        </button>
                    </div>
                </div>
            );
        };

        // --- DERSLER / M√úFREDAT (YENƒ∞LENMƒ∞≈û) ---
        const Syllabus = ({ apiKey, goBack, openModal, startQuiz }) => {
            const [tab, setTab] = useState('MATEMATIK');
            const data = CURRICULUM[tab];
            
            const handleAction = async (action, topic) => {
                if(!apiKey) return alert("√ñnce anahtarƒ± girmelisin ≈üampiyon!");
                openModal({ type: 'loading' });
                try {
                    let prompt = "";
                    if(action === 'analyze') prompt = `Konu: ${topic}. 8. Sƒ±nƒ±f LGS i√ßin analiz et. Zorluk, √ßƒ±kma ihtimali ve p√ºf noktalarƒ±. HTML formatƒ±nda ≈üƒ±k bir √∂zet.`;
                    else if(action === 'hap') prompt = `Konu: ${topic}. LGS i√ßin en √∂nemli 5 hap bilgiyi maddeler halinde yaz. HTML ul-li formatƒ±.`;
                    const res = await callGoogle(apiKey, DEFAULT_MODEL, prompt, 'html');
                    openModal({ type: 'content', title: topic, content: res });
                } catch(e) { openModal(null); alert("Hata: " + e.message); }
            };

            return (
                <div className="h-full flex flex-col bg-slate-50 anim-fade">
                    <div className="bg-white p-4 md:p-6 shadow-sm flex items-center gap-4 z-10 sticky top-0">
                        <button onClick={goBack} className="bg-slate-100 p-3 rounded-xl hover:bg-slate-200"><Icon name="arrow-left" size={24}/></button>
                        <h2 className="font-bold text-xl md:text-2xl text-slate-800">Dersler & Soru Bankasƒ±</h2>
                    </div>
                    <div className="p-4 md:p-6 overflow-x-auto whitespace-nowrap bg-white border-b hide-scroll">
                        {Object.keys(CURRICULUM).map(key => (
                            <button key={key} onClick={()=>setTab(key)} className={`px-6 py-3 rounded-full font-bold mr-3 text-sm md:text-base border-2 transition shadow-sm ${tab===key ? BUTTON_COLORS[key] + ' text-white border-transparent scale-105' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`}>
                                {CURRICULUM[key].title}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 pb-24">
                        {data.units.map(u => (
                            <div key={u.id} className={`rounded-[2rem] border-2 overflow-hidden shadow-sm ${THEME_COLORS[tab]}`}>
                                <div className="p-5 font-bold border-b border-inherit bg-white/60 flex items-center gap-3 text-lg">
                                    <span className={`w-8 h-8 rounded-full text-white flex items-center justify-center text-sm shadow ${BUTTON_COLORS[tab].split(' ')[0]}`}>{u.id}</span>
                                    {u.title}
                                </div>
                                <div className="divide-y divide-inherit bg-white/30">
                                    {u.topics.map(t => (
                                        <div key={t} className="p-5 hover:bg-white transition duration-300">
                                            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                                <div className="font-bold text-lg md:text-xl text-slate-800 flex items-center gap-2"><div className={`w-2 h-2 rounded-full ${BUTTON_COLORS[tab].split(' ')[0]}`}></div>{t}</div>
                                                <div className="flex flex-wrap gap-2">
                                                    <button onClick={()=>handleAction('analyze', t)} className="px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold hover:bg-slate-50 text-slate-600 flex items-center gap-2"><Icon name="bar-chart-2" size={16}/> Analiz</button>
                                                    <button onClick={()=>handleAction('hap', t)} className="px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold hover:bg-slate-50 text-slate-600 flex items-center gap-2"><Icon name="pill" size={16}/> √ñzet</button>
                                                    
                                                    {/* YENƒ∞ SORU √á√ñZ BUTONU */}
                                                    <button onClick={()=>startQuiz(t)} className="px-6 py-2 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 shadow-md flex items-center gap-2 active:scale-95 transition">
                                                        <Icon name="play-circle" size={20}/> SORU √á√ñZ
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const SimpleTool = ({ apiKey, goBack, type }) => {
            const [input, setInput] = useState("");
            const [res, setRes] = useState(null);
            const [loading, setLoading] = useState(false);

            const run = async () => {
                if(!apiKey || !input) return;
                setLoading(true);
                try {
                    let prompt = "";
                    if(type === 'solver') prompt = `LGS √ñƒürencisiyim. ≈ûu soruyu benim i√ßin adƒ±m adƒ±m, anla≈üƒ±lƒ±r ve eƒülenceli ≈üekilde √ß√∂z: ${input}. HTML formatƒ±nda √ßƒ±ktƒ± ver.`;
                    else if(type === 'planner') prompt = `G√ºnde ${input} saat √ßalƒ±≈üabilirim. Bana 8. sƒ±nƒ±f LGS i√ßin haftalƒ±k ders √ßalƒ±≈üma programƒ± yap. HTML tablo formatƒ±nda.`;
                    
                    const result = await callGoogle(apiKey, DEFAULT_MODEL, prompt, 'html');
                    setRes(result);
                } catch(e) { alert("Hata: " + e.message); } finally { setLoading(false); }
            };

            const titles = { solver: 'Soru √á√∂z√ºc√º', planner: 'Akƒ±llƒ± Program' };
            const placeholders = { solver: 'Sorunu buraya yapƒ±≈ütƒ±r...', planner: 'G√ºnde ka√ß saat √ßalƒ±≈üƒ±rsƒ±n? (Sadece sayƒ±)' };

            return (
                <div className="h-full bg-slate-50 p-6 md:p-10 flex flex-col anim-fade">
                    <div className="flex items-center gap-4 mb-8">
                        <button onClick={goBack} className="bg-white p-4 rounded-xl shadow hover:bg-slate-100"><Icon name="arrow-left" size={24}/></button>
                        <h2 className="text-3xl font-black text-slate-800">{titles[type]}</h2>
                    </div>
                    <div className="bg-white p-6 md:p-8 rounded-[2rem] shadow-xl border border-slate-100 flex flex-col h-full overflow-hidden max-w-5xl mx-auto w-full">
                        <div className="mb-6">
                            <textarea value={input} onChange={e=>setInput(e.target.value)} className="w-full p-5 bg-slate-50 border-2 border-slate-200 rounded-2xl outline-none focus:border-indigo-500 h-40 resize-none text-lg md:text-xl" placeholder={placeholders[type]}></textarea>
                            <button onClick={run} disabled={loading} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold mt-4 shadow-lg hover:bg-indigo-700 transition text-lg md:text-xl flex items-center justify-center gap-2">
                                {loading ? "Yapay Zeka √áalƒ±≈üƒ±yor..." : <><Icon name="zap"/> G√∂nder Gelsin</>}
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto bg-slate-50 rounded-2xl p-6 border border-slate-200 shadow-inner">
                            {res ? <div className="prose prose-lg readable-text max-w-none" dangerouslySetInnerHTML={{__html: res}}></div> : <div className="flex flex-col items-center justify-center h-full text-slate-400"><Icon name="cpu" size={64} className="mb-4 opacity-50"/><p className="text-xl font-bold">Sonu√ß Ekranƒ±</p></div>}
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ data, close }) => {
            if(!data) return null;
            return (
                <div className="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm anim-fade" onClick={close}>
                    <div className="bg-white w-full max-w-3xl max-h-[85vh] rounded-[2.5rem] p-8 shadow-2xl overflow-y-auto relative border-4 border-slate-50" onClick={e=>e.stopPropagation()}>
                        {data.type === 'loading' ? (
                            <div className="flex flex-col items-center py-12"><div className="loader mb-6 w-12 h-12"></div><p className="font-bold text-slate-500 text-xl animate-pulse">Yapay Zeka Hazƒ±rlƒ±yor...</p></div>
                        ) : (
                            <>
                                <div className="flex justify-between items-center mb-6 border-b pb-4">
                                    <h3 className="text-2xl md:text-3xl font-black text-indigo-700">{data.title}</h3>
                                    <button onClick={close} className="p-3 bg-slate-100 rounded-full hover:bg-slate-200 transition"><Icon name="x" size={24}/></button>
                                </div>
                                <div className="prose prose-lg prose-slate readable-text max-w-none" dangerouslySetInnerHTML={{__html: data.content}}></div>
                            </>
                        )}
                    </div>
                </div>
            )
        };

        const App = () => {
            const [view, setView] = useState('dashboard'); // dashboard, syllabus, quiz_runner, solver, planner
            const [apiKey, setApiKey] = useState(localStorage.getItem('lgs_key'));
            const [modal, setModal] = useState(null);
            
            // Quiz Runner State
            const [quizTopic, setQuizTopic] = useState(null);
            const [quizConfig, setQuizConfig] = useState(null);

            const daysLeft = Math.ceil((new Date('2026-06-07') - new Date()) / (1000 * 60 * 60 * 24));

            const startQuiz = (topic) => {
                setQuizTopic(topic);
                setQuizConfig(null);
                setView('quiz_runner');
            };

            const startTrial = (config) => {
                setQuizConfig(config);
                setQuizTopic(null);
                setView('quiz_runner');
            };

            return (
                <div className="h-full w-full relative">
                    {modal && <Modal data={modal} close={()=>setModal(null)} />}
                    
                    {view === 'dashboard' && <Dashboard apiKey={apiKey} setApiKey={setApiKey} goView={setView} daysLeft={daysLeft} startTrial={startTrial} />}
                    {view === 'syllabus' && <Syllabus apiKey={apiKey} goBack={()=>setView('dashboard')} openModal={setModal} startQuiz={startQuiz} />}
                    
                    {view === 'quiz_runner' && <QuizRunner apiKey={apiKey} topic={quizTopic} config={quizConfig} goBack={()=>setView('dashboard')} />}
                    
                    {['solver', 'planner'].includes(view) && <SimpleTool type={view} apiKey={apiKey} goBack={()=>setView('dashboard')} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

